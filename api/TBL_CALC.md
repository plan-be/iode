<!-- This content was generated by scr4w_amd -->

# Table of Contents



- [IODE: Table calculations](#T1)
    - [GSAMPLE](#T2)
      - [GSAMPLE syntax](#T3)
    - [c\_cc.c](#T4)
    - [c\_calc.c](#T5)
    - [k\_print.c](#T6)
    - [Translations](#T7)
      - [k\_lang.c](#T8)

# IODE: Table calculations {#T1}

When a table is printed, the cell values are simple texts or numbers calculated from the LEC formulas included in the table definition on a GSAMPLE.

The table formulas don't give indication on the period(s), the files, nor the representation of the values (growth rates, differences...).

The purpose of the GSAMPLE is to provide these informations.

### GSAMPLE {#T2}

A GSAMPLE (generalised printing sample) determines the source of the variables and the transformations applied to these values like growth rates of differences in percents.

For tables, each column of a table is printed for every (period / file) given in the GSAMPLE.

The GSAMPLE contains informations about:

- the periods to be printed
- the operations to perform on the selected periods, such as growth rates...
- the files where the variables are to be found

For example:

- "2000:10" means "10 consecutive periods beginning in 2000".
- "2000Q2/2000Q1:5\[1;2\]" means "5 consecutive growth rates beginning in 2000Q2 from the current values in the workspace (\[1\]) and the file number \[2\]".
- etc.

The available operations on periods include :

- values (75;80;85)
- growth rates between one or more periods (75/74, 75/70)
- average growth rates (75//70)
- differences and average diffences (75\-74, 75\-\-70)
- means, sums, indices

The available operations on files include :

- level \[1\]
- differences (\[1\-2\])
- differences in % (\[1/2\])
- etc

The detailed GSAMPLE syntax can be found in the IODE manual (https://iode.plan.be/doku.php?id=sample\_d\_impression).

#### GSAMPLE syntax {#T3}

```
   gsample    ::= gsample_n[';'gsample_n...]
   gsample_n  ::= gsample_1[repetition['*'['-']increment]] 
   repetition ::= integer
   increment  ::= integer
   gsample_1  ::= period_ops [file_ops]
 
   period_ops ::= period_op | '('period_op';'period_op...')'
   period_op  ::= period[op period] ['>'shift] ['<'shift]
   period     ::= integer[periodicity period] | 
                   'EOS' | 'BOS' | 'NOW' | 'EOS1' | 'BOS1' |'NOW1'
   shift      ::= 0 | integer
   
   file_ops   ::= file_op | '['file_op';'file_op...']'
   file_op    ::= file[op file]
```

### c\_cc.c {#T4}

GSAMPLE compilation functions.

|Syntax|Description|
|:---|:---|
|`COLS *COL_cc(char* gsample)`|GSAMPLE compiler|
|`int COL_free_cols(COLS* cls)`|Frees the allocated space for a COLS structure created by COL\_cc()|
|`char *COL_text(COL* cl, char* str, int nbnames)`|Constructs a string based on a special table cell text value containing a "|
|`COLS *COL_add_col(COLS* cls)`|Adds a new COL struct to the COLS (list of periods in a GSAMPLE)|
|`int COL_find_mode(COLS* cls, int* mode, int type)`|Analyses a COLS struct and set 1 in the vector mode for each found operation|

### c\_calc.c {#T5}

Table calculation on a GSAMPLE.

|Syntax|Description|
|:---|:---|
|`int COL_exec(TBL* tbl, int i, COLS* cls)`|Calculates the values of all LEC formulas in one TBL line for all columns of a GSAMPLE.|
|`int COL_resize(TBL* tbl, COLS* cls)`|Extends the number of COL's (compiled GSAMPLE) by multiplying by the number of columns in a TBL definition|
|`void COL_clear(COLS* cls)`|Resets the calculated values in a COLS structure.|

### k\_print.c {#T6}

Functions to generate IODE tables in A2M format based on TBL structures and GSAMPLE definition. Includes some A2M helper functions.

|Syntax|Description|
|:---|:---|
|`int T_prep_cls(TBL* tbl, char* smpl, COLS** cls)`|Compiles a GSAMPLE into a COLS struct and resizes COLS according to the nb of cols in TBL|
|`void T_fmt_val(char* buf, IODE_REAL val, int lg, int nd)`|Formats a double value|
|`void T_print_val(IODE_REAL val)`|Prints a IODE\_REAL value using W\_printf()|
|`void T_align(int attr, int straddle, int type)`|Prints the header of an a2m table cell|
|`void T_open_attr(int attr)`|Opens an A2M attribute sequence.|
|`void T_close_attr(int attr)`|Closes an A2M attribute sequence.|
|`void T_print_cell(TCELL* cell, COL* cl, int straddle)`|Prints a TBL cell on a specific GSAMPLE column.|
|`char **T_find_files(COLS* cls)`|Retrieves the filenames used in the COLS (from GSAMPLE) needed to print the special table line KT\_FILES.|
|`unsigned char *T_get_title(TBL* tbl)`|Retrieves a TBL title, i.e. the contents of the first line of type KT\_TITLE|
|`int T_print_tbl(TBL* tbl, char* smpl)`|Computes a table on a GSAMPLE and saves the result in A2M format|

Global variables \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

|Variable|Default value|Description|
|:---|:---|:---|
|`char KT_sep`|` '&'`|Table cell separator|
|`int K_NBDEC`|` -1`|Default nb of decimals|

### Translations {#T7}

The printed/displayed version of computed tables and graphs contain texts that can be translated. Three languages are available: French, Dutch and English. The translated strings are grouped in `api/k_lang.c`.

#### k\_lang.c {#T8}

|Variables|Description|
|:---|:---|
|`char *KLG_TYPE[][3]`|Texts describing object types|
|`char *KLG_MONTHS[][3]`|Texts representing Months|
|`char *KLG_ROM[]`|Roman numerals from 1 to 12|
|`char *KLG_CALC[3]`|Legends for computed values line in estimation graphs|
|`char *KLG_OBS[3]`|Legends for observed values line in estimation graphs|
|`char *KLG_RES[3]`|Legends for residuals in estimation graphs|
|`char *KLG_MODES[5][3]`|Display modes for variables in computed Tables and Graphs|
|`char *KLG_OPERS_TEXTS[][3]`|Texts representing operations on files and periods in computed tables and graphs|

