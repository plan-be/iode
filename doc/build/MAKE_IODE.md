<!-- This content was generated by scr4w_amd -->

# Table of Contents



- [IODE: rebuilding IODE installer](#T1)
  - [STEP 1 : Changer le numéro de version](#T2)
  - [STEP 2 : Préparation des manuels (chm et wiki)](#T3)
  - [STEP 3 : génération du manuel en pdf (optionnel)](#T4)
    - [1. Créer le fichier mif (maker interchange format)](#T5)
    - [2. Créer iode6.pdf](#T6)
  - [STEP 4 : préparer les pages start.txt et sidebar.txt pour site web de IODE](#T7)
  - [STEP 5 : rebuild iode, manuals et installateurs](#T8)
  - [STEP 6 : transférer la nouvelle version sur le site web de IODE](#T9)

# IODE: rebuilding IODE installer {#T1}

- STEP 1 : Changer le numéro de version
- STEP 2 : préparation des manuels (chm et wiki)
- STEP 3 : génération du manuel en pdf (optionnel)
- STEP 4 : préparer les pages start.txt et sidebar.txt pour site web de IODE
- STEP 5 : rebuild iode, manuals et installateurs
- STEP 6 : transférer la nouvelle version sur le site web de IODE

## STEP 1 : Changer le numéro de version {#T2}

La localisation des numéros de version et des dates à modifier se trouve dans le fichier `iode_src/nsis_installer/chvers`.

On peut éditer chvers avec l'éditeur e.bat (mt) qui permet d'ouvrir les fichiers concernés à la bonne ligne avec la touche `Ctrl-F4`.

```
c:/> cd /usr/iode_src/nsis_installer
c:/usr/iode_src/nsis_installer> e chvers
```

**Fichier chvers en mars 2023**

```
    ..\api\vers.h  1
    ..\apiode.H  37       
```

```
    ..\apiode.H  39
    ..\dosOMMON.F        4       
```

```
    ..\dosOMMON.F        88      ?++   _ ++ ?++ ?++ ?++_¦ ++ ? --_ ++   Version 4.44 - 01/94 ?
    ..\dosOMMON.F        119          C_FN SCR_lock_screen("I.O.D.E. 4.44");
    ..\dos\version.txt     1      IODE 6.46
    ..odecom\frmMain.cpp   197    mLog->Lines->Add("IodeComServer v6.64 27/02/2023");
    ..\manrcntro.m1 80
    iode_mui.nsi 5
    iode_mui.nsi 21
    iode_mui_upd.nsi 5
    iode_mui_upd.nsi 21
    iode.rtf
    iode_upd.rtf
    makeinst.bat 7
    ..\manrctart.txt 19 => changer les versions + liens
    copy2ovh.bat 52     echo mput iode664*.exe                      > upload_iode_ovh.ftp
```

## STEP 2 : Préparation des manuels (chm et wiki) {#T3}

Aller dans le dir iode\_src/man :

```
c:/> cd /usr/iode_src/man
```

Préparation de la mise à niveau du manuel (fichiers .m)

- adapter readme.m : ajouter les commentaires de la version \+ reporter dans le manuel si nécessaire
- adapter iodew.m (ajouter au début du fichier la ligne avec la nouvelle version
- adapter la date de publication dans intro.m1 (voir aussi chvers plus haut)
- créer les images des nouveaux écrans iode si nécessaire, sauver en bmp ? ou png ? et les inclure dans les sources du manuel (.m)

## STEP 3 : génération du manuel en pdf (optionnel) {#T4}

Cette étape nécessite le programme Adobe/Framemaker.

En résumé :

- créer les fichiers mif
- éditer en Frame
- sauver en PDF
- recopier dans man

### 1. Créer le fichier mif (maker interchange format) {#T5}

\*\*\*\* En cours de révision \*\*\*\*

Dans iode\_src/man, lancer la commande :

```
 c:/usr/iode_src/man> makemif.bat
 c:/usr/iode_src/man> copy iode?.mif iodeman
```

### 2. Créer iode6.pdf {#T6}

Note préalable

La découpe du manuel en pdf est un peu différente de celle en chm et en wiki :

- on a un chapitre 8 avec les algorithmes
- une partie "fixe" contient tout ce qui est écrans et graphiques (a2m, excel, apl, algo).
- la syntaxe des a2m est déplacée dans les annexes

Les fichiers .m et .m1 sont donc différents entre la sortie mif et les autres.

*Mode d'emploi*

Dans usr/iode\_src/man/iodeman

- Open Frame
- Open c:/iode/iodeman/iode6.book
- open iode6.ref.fm
- open iodecover.fm
- changer la date du cover
- Open iode1.mif et iode2.mif
- Dans iode2.mif :
- supprimer la première page avec Annexes1
- forcer un saut de page pour l'annexe 1
- Pour les deux docs :
- Alt\+fio (File/Import/Formats) : choisir iode6.ref.fm
- Alt\+olm (Format/Page Layout/Master Page Usage) : Right /Left \+ Apply to All Pages
- Alt\+fa (Save As) iode1.mif en iode6\-1.fm et iode2.mif en iode6\-2.fm
- Pour iode6.book : Alt\+eb (book?Edit/Update) : appliquer les modifs dans toc
- sauver book, iodecover.fm, iode6toc.fm, iode6\-1.fm, iode6\-2.fm
- si distiller installé : save book as pdf (niveaux tit\_1 à tit\_4) \-> lent \!
- sinon: print vers pdf file (dans ce cas, pas de TOC dans les lecteurs PDF)
- recopier iode6.pdf dans man sous le nom iode.pdf : `copy iode6.pdf ../iode.pdf`

## STEP 4 : préparer les pages start.txt et sidebar.txt pour site web de IODE {#T7}

Avant de transférer sur le site, il faut adapter manuellement les fichiers suivants.

**man/src/start.txt**

- Ajouter les liens vers les nouveaux installateurs dans la section "Download"
- Si d'application, ajouter dans la section "IODE for python" la version iode.pyd pour une nouvelle version de python

**man/src/sidebar.txt**

Revoir cette section et y ajouter éventuellement de nouveaux chapitres (par exemple pour le manuel de iode.pyd).

## STEP 5 : rebuild iode, manuals et installateurs {#T8}

Note : Note préalable : il faut vérifier que les makefiles qui créent des exécutables (iode.exe, iodecmd.exe, iodecom.exe...) soient bien signés avant de lancer la procédure de recompilation (on supprime la signature pendant les développements pour que le debugger td32 puisse fonctionner).

Se placer dans `iode_src/nsis_installer` pour recontruire

- les libs
- les exécutables
- les différentes versions des manuels (sauf pdf) :

```
c:> cd /usr/iode_src/nsis_installer
c:/usr/iode_src/nsis_installer> remakeiode [-objs] [-man]
```

Les options \-objs et \-man permettent d'éviter la recompilation de toutes les sources et la génération des manuels, par exemple pendant une phase de mise au point.

- \-man : ne génére par le manuel (iode.chm) et les pages du wiki
- \-objs : ne compile pas les fichiers sources inchangés

Le programme génère d'abord les librairies nécessaires en 32 et 64 bits (64 bits uniquement pour pyiode).

En sortie, les fichiers suivants auront été regénérés :

- cmd/iodecmd.exe
- dos/iode.exe
- iodecom/iodecom.exe
- pyiode/py39/iode.pyd
- pyiode/py310/iode.pyd
- man/readme.htm
- man/iode.chm
- nsis\_installer/iode6xx.exe
- nsis\_installer/iode6xx\_upd.exe
- <local\_htdocs>/w\-iode/data/pages/\*
- <local\_htdocs>/w\-iode/data/media/\*

**Fichier remakeiode.bat (mars 2023)**

```
    :: Rebuild IODE and create installation programs
    :: 
    SETLOCAL
    
    set man=1
    set objs=1
    if /I [%1] == [-man] set man=0
    if /I [%2] == [-man] set man=0
    if /I [%1] == [-objs] set objs=0
    if /I [%2] == [-objs] set objs=0
    
    set iodepath=c:srode_src
    ;set pyiodepath= %USERPROFILE%ource\reposodeyiode
    set pyiodepath= %iodepath%yiode
    set scr4path=c:srcr4_src
    
    :: goto :MAN
    
    :: SCR Borland 32
    cd %scr4path%
    if [%objs%] == [1] (
        del *.io
        del *.w32
        make -DCodeGear scr4iode s32wo
        if %errorlevel% NEQ 0 goto :err
        )
    
    :: API Borland 32
    cd %iodepath%\api
    if [%objs%] == [1] del *.obj
    make
    if %errorlevel% NEQ 0 goto :err
    
    :: CMD Borland 32
    cd %iodepath%md
    if [%objs%] == [1] del *.obj
    make
    if %errorlevel% NEQ 0 goto :err
    
    :: DOS Borland 32
    cd %iodepath%\dos
    if [%objs%] == [1] del *.obj
    del o_objs.*
    make
    if %errorlevel% NEQ 0 goto :err
    
    :MAN
    if [%man%] == [1] (
        cd %iodepath%\man
        ::make readme.htm iode.chm 
        call makereadme.bat
        if %errorlevel% NEQ 0 goto :err
        call makechm.bat
        if %errorlevel% NEQ 0 goto :err
        ::make iode.wiki
        call makewiki.bat
        if %errorlevel% NEQ 0 goto :err
        )
    
    :: IODECOM
    cd %iodepath%odecom
    call make64
    if %errorlevel% NEQ 0 goto :err
    
    :: goto :EOF
    
    :: iode.pyd -- python dll 64 bits
    :pyiode
    call c:cret64.bat
    
    :: 1. scr4 libs VC64
    cd %scr4path%\vc64
    if [%objs%] == [1] del *.obj
    call nmake s4iode.lib
    if %errorlevel% NEQ 0 goto :err
    
    :: 2: iodelibs VC64
    cd %iodepath%\api\vc64
    if [%objs%] == [1] del *.obj
    call nmake iodeapi.lib
    if %errorlevel% NEQ 0 goto :err
    
    :: 3. iode.pyd
    cd %iodepath%yiode
    del iode.c
    
    :: python 3.9 => pyiode\vc64y39ode.pyd
    call activate py39
    call makepy.bat
    if %errorlevel% NEQ 0 goto :err
    
    :: python 3.10 => pyiode\vc64y10ode.pyd
    call activate py10
    call makepy.bat
    if %errorlevel% NEQ 0 goto :err
    
    :: NSIS
    cd %iodepath%\nsis_installer
    call makeinst.bat
    if %errorlevel% NEQ 0 goto :err
    
    @echo !!! Success !!!
    endlocal
    goto :EOF
    
    :err
    Echo !!!! Error !!!!
    cd %iodepath%\nsis_installer
    endlocal
    :fin
    endlocal
```

## STEP 6 : transférer la nouvelle version sur le site web de IODE {#T9}

Dans iode\_src/nsis\_installer, lancer la commande :

```
    c:/usr/iode_src/nsis_installer> copy2ovh.bat
```

**Fichier copy2ovh.bat (mars 2023)**

```
@echo off
SETLOCAL
:: Copie le site IODE vers iode.plan.be
 
:: Define local source directory
set IODE_DIR=/usr/iode_src
set PYIODE_DIR=%IODE_DIR%/pyiode
set WIKI_DIR=/apache24/htdocs/w-iode
 
:: Ouverture et mode
echo open ftp.cluster011.ovh.net > upload_iode_ovh.ftp
echo ibfpbevvwp>> upload_iode_ovh.ftp
echo dVz5Rc6VMhQH>> upload_iode_ovh.ftp
echo binary>> upload_iode_ovh.ftp
echo prompt>> upload_iode_ovh.ftp
 
::goto pages
 
:: Python modules
echo cd /www/w-iode/data/media/download         >> upload_iode_ovh.ftp
echo mkdir py36                                 >> upload_iode_ovh.ftp
echo mkdir py37                                 >> upload_iode_ovh.ftp
echo mkdir py38                                 >> upload_iode_ovh.ftp
echo mkdir py39                                 >> upload_iode_ovh.ftp
echo mkdir py310                                >> upload_iode_ovh.ftp
 
echo lcd %PYIODE_DIR%/py36                      >> upload_iode_ovh.ftp
echo cd /www/w-iode/data/media/download/py36    >> upload_iode_ovh.ftp
echo mput iode.pyd                              >> upload_iode_ovh.ftp
 
echo lcd %PYIODE_DIR%/py37                      >> upload_iode_ovh.ftp
echo cd /www/w-iode/data/media/download/py37    >> upload_iode_ovh.ftp
echo mput iode.pyd                              >> upload_iode_ovh.ftp
 
echo lcd %PYIODE_DIR%/py38                      >> upload_iode_ovh.ftp
echo cd /www/w-iode/data/media/download/py38    >> upload_iode_ovh.ftp
echo mput iode.pyd                              >> upload_iode_ovh.ftp
 
echo lcd %PYIODE_DIR%/py39                      >> upload_iode_ovh.ftp
echo cd /www/w-iode/data/media/download/py39    >> upload_iode_ovh.ftp
echo mput iode.pyd                              >> upload_iode_ovh.ftp
 
echo lcd %PYIODE_DIR%/py310                     >> upload_iode_ovh.ftp
echo cd /www/w-iode/data/media/download/py310   >> upload_iode_ovh.ftp
echo mput iode.pyd                              >> upload_iode_ovh.ftp
 
::goto fini
 
:: Installer
echo cd /www/w-iode/data/media/download         >> upload_iode_ovh.ftp
echo lcd %IODE_DIR%/nsis_installer              >> upload_iode_ovh.ftp
echo mput iode665*.exe                          >> upload_iode_ovh.ftp
 
:: Manuals
echo cd /www/w-iode/data/media/download         >> upload_iode_ovh.ftp
echo lcd %IODE_DIR%/man                         >> upload_iode_ovh.ftp
echo put iode.chm                               >> upload_iode_ovh.ftp
echo put iode.pdf                               >> upload_iode_ovh.ftp
 
:: Goodies
echo cd /www/w-iode/data/media/download         >> upload_iode_ovh.ftp
echo lcd %IODE_DIR%/goodies                     >> upload_iode_ovh.ftp
echo mput *                                     >> upload_iode_ovh.ftp
 
:pages
 
:: Wiki pages
echo cd /www/w-iode/data/pages                  >> upload_iode_ovh.ftp
echo lcd %WIKI_DIR%/data/pages                  >> upload_iode_ovh.ftp
echo mput *.txt                                 >> upload_iode_ovh.ftp
 
::goto fini
 
:images
echo cd /www/w-iode/data/media                  >> upload_iode_ovh.ftp
echo mkdir wiki                                 >> upload_iode_ovh.ftp
echo cd wiki                                    >> upload_iode_ovh.ftp
echo lcd %IODE_DIR%/man/src                     >> upload_iode_ovh.ftp
echo mput *.jpg                                 >> upload_iode_ovh.ftp
echo mput *.gif                                 >> upload_iode_ovh.ftp
echo mput *.png                                 >> upload_iode_ovh.ftp
            
:: Version          
echo cd /www/w-iode                             >> upload_iode_ovh.ftp
echo lcd %IODE_DIR%/dos                         >> upload_iode_ovh.ftp
echo put version.txt                            >> upload_iode_ovh.ftp
            
:fini           
echo quit                                       >> upload_iode_ovh.ftp
 
 
@echo on
ftp -s:upload_iode_ovh.ftp > ftp_upload_iode_ovh.log
 
ENDLOCAL
```

That's all, folks \!

