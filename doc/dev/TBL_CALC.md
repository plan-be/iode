<!-- This content was generated by scr4w_amd -->

# Table of Contents



- [IODE: Table calculations](#T1)
    - [GSample](#T2)
      - [Formal definition of a GSample](#T3)
    - [c\_cc.c](#T4)
    - [c\_calc.c](#T5)
    - [k\_print.c](#T6)
    - [k\_graph.c](#T7)
    - [Translations](#T8)
      - [k\_lang.c](#T9)

# IODE: Table calculations {#T1}

When a table is printed, the cell values are simple texts or numbers calculated from the LEC formulas included in the table definition on a GSample. The same is true for the line or bar charts generated from IODE Tables.

Indeed, the table formulas don't give indication on the period(s), the files, nor the representation of the values (growth rates, differences...).

The purpose of the GSample is to provide these informations.

### GSample {#T2}

A GSample (generalised printing sample) determines the source of the variables and the transformations applied to these values like growth rates of differences in percents.

For tables, each column of a table is printed for every (period / file) given in the GSample.

The GSample contains informations about:

- the periods to be printed
- the operations to perform on the selected periods, such as growth rates...
- the files where the variables are to be found

For example:

- "2000:10" means "10 consecutive periods beginning in 2000".
- "2000Q2/2000Q1:5\[1;2\]" means "5 consecutive growth rates beginning in 2000Q2 from the current values in the workspace (\[1\]) and the file number \[2\]".
- etc.

The available operations on periods include :

- values (75;80;85)
- growth rates between one or more periods (75/74, 75/70)
- average growth rates (75//70)
- differences and average diffences (75\-74, 75\-\-70)
- means, sums, indices

The available operations on files include :

- level \[1\]
- differences (\[1\-2\])
- differences in % (\[1/2\])
- etc

Examples and more details on GSample can be found in the IODE manual (https://iode.plan.be/doku.php?id=sample\_d\_impression).

#### Formal definition of a GSample {#T3}

```
     gsample    ::= gsample_n[';'gsample_n...]
     gsample_n  ::= gsample_1[repetition['*'['-']increment]] 
     repetition ::= integer
     increment  ::= integer
 
     gsample_1  ::= period_ops [file_ops]
     period_ops ::= period_op | '(' period_op ';' period_op... ')'
     period_op  ::= period [opp period] ['>' shift] ['<' shift]
     period     ::= integer[periodicity period] | 
                     'EOS' | 'BOS' | 'NOW' | 'EOS1' | 'BOS1' |'NOW1'
     shift      ::= 0 | integer
     opp        ::= '-' | '--' | '/' | '//' | '+' | '^' | '' | '=' 
 
     file_ops   ::= '[' file_op | file_op ';' file_op ']'
     file_op    ::= file [opf file] 
     file       ::= integer
     opf        ::= '+' | '-' | '/' | '+' | '^' 
```

### c\_cc.c {#T4}

GSample compilation functions.

|Syntax|Description|
|:---|:---|
|`COLS *COL_cc(char* gsample)`|GSample compiler|
|`int COL_free_cols(COLS* cls)`|Frees the allocated space for a COLS structure created by COL\_cc()|
|`char *COL_text(COL* cl, char* str, int nbnames)`|Constructs a string based on a special table cell text value containing a "\#"|
|`COLS *COL_add_col(COLS* cls)`|Adds a new COL struct to the COLS (list of periods in a GSample)|
|`int COL_find_mode(COLS* cls, int* mode, int type)`|Analyses a COLS struct and set 1 in the vector mode for each found operation|

### c\_calc.c {#T5}

Table calculation on a GSample.

|Syntax|Description|
|:---|:---|
|`int COL_exec(Table* tbl, int i, COLS* cls)`|Calculates the values of all LEC formulas in one Table line for all columns of a GSample.|
|`int COL_resize(Table* tbl, COLS* cls)`|Extends the number of COL's (compiled GSample) by multiplying by the number of columns in a Table definition|
|`void COL_clear(COLS* cls)`|Resets the calculated values in a COLS structure.|

### k\_print.c {#T6}

Functions to generate IODE tables in A2M format based on Table structures and GSample definition. Includes some A2M helper functions.

|Syntax|Description|
|:---|:---|
|`int T_prep_cls(Table* tbl, char* smpl, COLS** cls)`|Compiles a GSample into a COLS struct and resizes COLS according to the nb of cols in Table|
|`void T_fmt_val(char* buf, double val, int lg, int nd)`|Formats a double value|
|`void T_print_val(double val)`|Prints a IODE\_REAL value using W\_printf()|
|`void T_open_cell(int attr, int straddle, int type)`|Prints the header of an a2m table cell|
|`void T_open_attr(int attr)`|Opens an A2M attribute sequence.|
|`void T_close_attr(int attr)`|Closes an A2M attribute sequence.|
|`void T_print_cell(TableCell* cell, COL* cl, int straddle)`|Prints a Table cell on a specific GSample column.|
|`char **T_find_files(COLS* cls)`|Retrieves the filenames used in the COLS (from GSample) needed to print the special table line KT\_FILES.|
|`unsigned char *T_get_title(Table* tbl)`|Retrieves a Table title, i.e. the contents of the first line of type KT\_TITLE|
|`int T_print_tbl(Table* tbl, char* smpl)`|Computes a table on a GSample and saves the result in A2M format|

Global variables

|Variable|Default value|Description|
|:---|:---|:---|
|`char KT_sep`|` '&'`|Table cell separator|
|`int K_NBDEC`|` -1`|Default nb of decimals|

### k\_graph.c {#T7}

Functions to generate IODE graphs in A2M format based on a Table structure and a GSample definition. Contains also V\_graph(), a function to print or display variables or combinations of variables on a (simple) Sample.

Includes some A2M helper functions.

|Syntax|Description|
|:---|:---|
|`int T_GraphInit(double w, double h, int xgrid, int ygrid, double ymin, double ymax, double zmin, double zmax, int align, int box, int brush)`|Initialises a graph by sending a2m commands to W\_printf().|
|`int T_GraphTest(Table *tbl)`|Displays the table tbl as a graph (in level) on the full sample of the current WS.|
|`int T_GraphEnd()`|Ends a A2M graph definition by sending the a2m command ".ge" to W\_printf().|
|`int T_graph_tbl_1(Table *tbl, char *gsmpl, int mode)`|Generates one graph in A2M format from a Table struct and a GSample.|
|`int T_GraphTitle(char *txt)`|Defines the graph title by sending a2m command ".gtitle" to W\_printf().|
|`int T_GraphLegend(int axis, int type, char *txt, char *fileop)`|Adds (in A2M) graph \*time\* axis (.gty or .gtz, see a2m language) with its position, type and title.|
|`int T_GraphXYLegend(int axis, int type, char *txt, char *fileop)`|Adds (in A2M) graph \*xy\* axis with its position, type and title.|
|`int T_GraphTimeData(Sample *smpl, double *y)`|Adds numerical data on a \*time\* graph line or bar.|
|`int T_GraphXYData(int nb, double *x, double *y)`|Adds numerical data on a \*xy\* graph line or bar.|
|`int T_GraphLine(Table *tbl, int i, COLS *cls, Sample *smpl, double *x, double *y, COLS *fcls)`|Adds graph curves from a table line definition and a calculated GSample.|
|`int T_find_opf(COLS *fcls, COL *cl)`|Tries to find the position in \*fcls of the opf (operation on files) in cl.|
|`int T_prep_smpl(COLS *cls, COLS **fcls, Sample *smpl)`|Given a compiled GSample, constructs a new COLS struct with unique file ops and the minimum Sample smpl containing all periods present in cls.|
|`int V_graph(int view, int mode, int type, int xgrid, int ygrid, int axis, double ymin, double ymax, Sample* smpl, char** names)`|Prints or displays graph(s) from variable list(s) or combination(s) or variables.|

### Translations {#T8}

The printed/displayed version of computed tables and graphs contain texts that can be translated. Three languages are available: French, Dutch and English. The translated strings are grouped in `api/k_lang.c`.

#### k\_lang.c {#T9}

|Variables|Description|
|:---|:---|
|`char *KLG_TYPE[][3]`|Texts describing object types|
|`char *KLG_MONTHS[][3]`|Texts representing Months|
|`char *KLG_ROM[]`|Roman numerals from 1 to 12|
|`char *KLG_CALC[3]`|Legends for computed values line in estimation graphs|
|`char *KLG_OBS[3]`|Legends for observed values line in estimation graphs|
|`char *KLG_RES[3]`|Legends for residuals in estimation graphs|
|`char *KLG_MODES[5][3]`|Display modes for variables in computed Tables and Graphs|
|`char *KLG_OPERS_TEXTS[][3]`|Texts representing operations on files and periods in computed tables and graphs|

